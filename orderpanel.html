<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('IMG_2099.jpeg');
            padding: 20px;
        }

        h2 {
            position: relative;
            left:0px;
            width:100%;
        }

        h3 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 36px; /* Increase font size */
    font-weight: bold; /* Make the text bold */
    color:#000000; /* Set a darker color to match your theme */
    text-shadow: 2px 2px 8px rgba(223, 132, 22, 0.2); /* Add shadow effect */
}

        .delivery-container, .canceled-orders, .delivery-history {
            background:none;
            padding: 20px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            width: 100%;
            margin: 20px auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #000000;
        }

        th {
            background-color: #b2793c;
        }

        td {
            word-wrap: break-word; /* Prevents text overflow in cells */
            max-width: 150px;
            color:rgb(0, 0, 0);
        }

        .profile-pic-container img {
            border-radius: 50%;
            width: 50px;
            height: 50px;
            object-fit: cover;
        }

        button {
            background: #000000;
            color: #796148;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #a8a8a8;
        }

        /* Ensuring each column has an even width */
        th, td {
            width: 10%;
        }

        /* Make sure the buttons are aligned */
        .order-summary button {
            width: 90%;
            margin: 5px auto;
        }

        /* Adjust for smaller screen sizes */
        @media (max-width: 768px) {
            table {
                font-size: 14px;
            }

            td, th {
                padding: 8px;
            }

            .profile-pic-container img {
                width: 40px;
                height: 40px;
            }

            button {
                padding: 8px 16px;
            }
        }
        /* Styling for the Date Selector */
#orderDate {
    width: 200px;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #361e00;
    border-radius: 5px;
    background-color: black;
    color: #796148;
    margin-top: 10px;
    text-align: center;
}

#orderDate:focus {
    outline: none;
    border-color: #796148;
}

label {
    font-weight: bolder;
}

div[style*="text-align: center;"] {
    position:absolute;
    left:30px;
}

div[style*="text-align: center;"] label {
    margin-bottom: 5px;
}
/* Style the date picker button */
#orderDate::-webkit-calendar-picker-indicator {
    background-color: #796148;/* Dark brown background */
    color:#796148; /* White arrow */
    border-radius: 5px;
}

/* For Firefox */
#orderDate::-moz-calendar-picker-indicator {
    background-color:#796148;/* Dark brown background */
    color: #796148; /* White arrow */
    border-radius: 5px;
}

.animated-shadow {
            box-shadow: 0px 0px 15px rgba(255, 165, 0, 0.5);
            animation: glow 1.5s infinite alternate;
        }
    </style>
</head>
<body>
    <h2 class="animated-shadow">___Delivery Panel___</h2>

    <!-- Date Selector -->
    <div style="text-align: center; margin-bottom: 20px;">
        <label for="orderDate">Select Date: </label>
        <input type="date" id="orderDate" name="orderDate" min="2025-02-18" max="<?php echo date('Y-m-d'); ?>">
    </div>

    <div class="delivery-container">
        <div class="order-summary">
            <h3>All Customer Orders</h3>
            <table>
                <thead>
                    <tr>
                        <th>Profile Pic</th>
                        <th>Customer Name</th>
                        <th>Address</th>
                        <th>Phone</th>
                        <th>Items Purchased</th>
                        <th>Total Price</th>
                        <th>Checkout Date</th>
                        <th>Order Status</th>
                        <th>Update Status</th>
                        <th>Cancel Order</th>
                    </tr>
                </thead>
                <tbody id="ordersTable"></tbody>
            </table>
        </div>
        <div class="update-all">
            <button id="updateAllButton">Update All Orders to Shipped</button>
        </div>
    </div>

    <div class="delivery-history">
        <h3>Delivery History</h3>
        <table>
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Shipped Time</th>
                    <th>Items Purchased</th>
                    <th>Total Price</th>
                </tr>
            </thead>
            <tbody id="deliveryHistoryTable"></tbody>
        </table>
    </div>

    <div class="canceled-orders">
        <h3>Canceled Orders</h3>
        <table>
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Address</th>
                    <th>Phone</th>
                    <th>Cancelled Time</th>
                </tr>
            </thead>
            <tbody id="canceledOrdersTable"></tbody>
        </table>
    </div>

    <script>
        // Sample data initialization
        if (!localStorage.getItem('deliveryOrders')) {
            localStorage.setItem('deliveryOrders', JSON.stringify([
                {
                    profilePic: 'https://via.placeholder.com/50',
                    name: 'John Doe',
                    address: '123 Main St',
                    phone: '555-5555',
                    itemsPurchased: 'Hammer, Nails',
                    totalPrice: '$50',
                    checkoutTime: '2025-02-19T14:00:00',
                    status: 'Pending'
                },
                {
                    profilePic: 'https://via.placeholder.com/50',
                    name: 'Jane Smith',
                    address: '456 Oak Rd',
                    phone: '555-1234',
                    itemsPurchased: 'Drill, Screws',
                    totalPrice: '$120',
                    checkoutTime: '2025-02-18T10:00:00',
                    status: 'Pending'
                }
            ]));
        }

        function displayAllOrders(date = null) {
            const deliveryOrders = JSON.parse(localStorage.getItem('deliveryOrders')) || [];
            const ordersTable = document.getElementById('ordersTable');
            ordersTable.innerHTML = ''; // Clear previous rows

            if (deliveryOrders.length === 0) {
                ordersTable.innerHTML = '<tr><td colspan="10">No orders found.</td></tr>';
            }

            const filteredOrders = date ? deliveryOrders.filter(order => new Date(order.checkoutTime).toISOString().split('T')[0] === date) : deliveryOrders;

            filteredOrders.forEach((order, index) => {
                const checkoutDate = new Date(order.checkoutTime).toLocaleString();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><div class="profile-pic-container"><img src="${order.profilePic || 'default-profile-pic.jpg'}" alt="Profile Picture"></div></td>
                    <td>${order.name}</td>
                    <td>${order.address}</td>
                    <td>${order.phone || 'N/A'}</td>
                    <td>${order.itemsPurchased || 'N/A'}</td>
                    <td>${order.totalPrice || 'N/A'}</td>
                    <td>${checkoutDate}</td>
                    <td>${order.status || 'Pending'}</td>
                    <td><button class="shipped-btn" data-index="${index}">Mark as Shipped</button></td>
                    <td><button class="cancel-btn" data-index="${index}">Cancel Order</button></td>
                `;
                ordersTable.appendChild(row);
            });

            // Attach event listeners for shipped and cancel buttons
            document.querySelectorAll('.shipped-btn').forEach(button => {
                button.addEventListener('click', function() {
                    markAsShipped(this.getAttribute('data-index'));
                });
            });

            document.querySelectorAll('.cancel-btn').forEach(button => {
                button.addEventListener('click', function() {
                    cancelOrder(this.getAttribute('data-index'));
                });
            });
        }

        function displayDeliveryHistory(date = null) {
            const deliveryHistory = JSON.parse(localStorage.getItem('deliveryHistory')) || [];
            const deliveryHistoryTable = document.getElementById('deliveryHistoryTable');
            deliveryHistoryTable.innerHTML = '';

            if (deliveryHistory.length === 0) {
                deliveryHistoryTable.innerHTML = '<tr><td colspan="4">No delivered orders found.</td></tr>';
            }

            const filteredHistory = date ? deliveryHistory.filter(order => new Date(order.shippedTime).toISOString().split('T')[0] === date) : deliveryHistory;

            filteredHistory.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.name}</td>
                    <td>${order.shippedTime}</td>
                    <td>${order.itemsPurchased || 'N/A'}</td>
                    <td>${order.totalPrice || 'N/A'}</td>
                `;
                deliveryHistoryTable.appendChild(row);
            });
        }

        function displayCanceledOrders(date = null) {
            const canceledOrders = JSON.parse(localStorage.getItem('canceledOrders')) || [];
            const canceledOrdersTable = document.getElementById('canceledOrdersTable');
            canceledOrdersTable.innerHTML = '';

            if (canceledOrders.length === 0) {
                canceledOrdersTable.innerHTML = '<tr><td colspan="4">No canceled orders found.</td></tr>';
            }

            const filteredCanceled = date ? canceledOrders.filter(order => new Date(order.cancelledTime).toISOString().split('T')[0] === date) : canceledOrders;

            filteredCanceled.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.name}</td>
                    <td>${order.address}</td>
                    <td>${order.phone || 'N/A'}</td>
                    <td>${order.cancelledTime}</td>
                `;
                canceledOrdersTable.appendChild(row);
            });
        }

        function markAsShipped(index) {
            const deliveryOrders = JSON.parse(localStorage.getItem('deliveryOrders')) || [];
            const order = deliveryOrders[index];
            if (order) {
                const shippedTime = new Date().toLocaleString();
                order.status = 'Shipped';
                order.shippedTime = shippedTime;

                // Update in storage
                localStorage.setItem('deliveryOrders', JSON.stringify(deliveryOrders));

                // Move to delivery history
                const deliveryHistory = JSON.parse(localStorage.getItem('deliveryHistory')) || [];
                deliveryHistory.push(order);
                localStorage.setItem('deliveryHistory', JSON.stringify(deliveryHistory));

                // Remove from current orders
                deliveryOrders.splice(index, 1);
                localStorage.setItem('deliveryOrders', JSON.stringify(deliveryOrders));

                displayAllOrders();
                displayDeliveryHistory();
            }
        }

        function cancelOrder(index) {
            const deliveryOrders = JSON.parse(localStorage.getItem('deliveryOrders')) || [];
            const order = deliveryOrders[index];
            if (order) {
                const cancelledTime = new Date().toLocaleString();
                order.status = 'Canceled';
                order.cancelledTime = cancelledTime;

                // Update in storage
                localStorage.setItem('deliveryOrders', JSON.stringify(deliveryOrders));

                // Move to canceled orders
                const canceledOrders = JSON.parse(localStorage.getItem('canceledOrders')) || [];
                canceledOrders.push(order);
                localStorage.setItem('canceledOrders', JSON.stringify(canceledOrders));

                // Remove from current orders
                deliveryOrders.splice(index, 1);
                localStorage.setItem('deliveryOrders', JSON.stringify(deliveryOrders));

                displayAllOrders();
                displayCanceledOrders();
            }
        }

        window.onload = function() {
            displayAllOrders();
            displayDeliveryHistory();
            displayCanceledOrders();
        };

        document.getElementById('updateAllButton').addEventListener('click', updateAllOrdersStatus);

        function updateAllOrdersStatus() {
            const deliveryOrders = JSON.parse(localStorage.getItem('deliveryOrders')) || [];
            if (deliveryOrders.length > 0) {
                const shippedTime = new Date().toLocaleString();
                deliveryOrders.forEach(order => {
                    order.status = 'Shipped';
                    order.shippedTime = shippedTime;
                });

                const deliveryHistory = JSON.parse(localStorage.getItem('deliveryHistory')) || [];
                deliveryHistory.push(...deliveryOrders);
                localStorage.setItem('deliveryOrders', JSON.stringify([]));
                localStorage.setItem('deliveryHistory', JSON.stringify(deliveryHistory));

                displayAllOrders();
                displayDeliveryHistory();
                alert('All orders have been updated to Shipped.');
            }
        }

        document.getElementById('orderDate').addEventListener('change', function() {
            const selectedDate = this.value;
            displayAllOrders(selectedDate);
            displayDeliveryHistory(selectedDate);
            displayCanceledOrders(selectedDate);
        });
    </script>
</body>
</html>
